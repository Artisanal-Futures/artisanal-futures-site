import dynamic from "next/dynamic";
import Head from "next/head";
import { useParams } from "next/navigation";

import ProfileCard from "~/apps/artisan-shops/components/profile-card";

import Body from "~/components/body";
import PageLoader from "~/components/ui/page-loader";

import { api } from "~/utils/api";

const ArtisanProductsGrid = dynamic(
  () => import("~/apps/artisan-shops/components/artisan-products-grid"),
  { ssr: false }
);

const ProfilePage = () => {
  const params = useParams();
  const { data: shop, isLoading } = api.shops.getShopById.useQuery({
    id: (params?.shopId as string) ?? "",
  });

  return (
    <>
      <Head>
        <title>Artisan Profile | Artisanal Futures</title>
        <meta name="description" content="Generated by create-t3-app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Body>
        {isLoading && <PageLoader />}
        {!isLoading && (
          <>
            <ProfileCard className="mx-auto h-full " {...shop} />

            <h2 className="scroll-m-20 border-b pb-2 text-3xl font-semibold tracking-tight first:mt-0">
              Products
            </h2>
            <ArtisanProductsGrid shopName={shop?.shopName} />
          </>
        )}
      </Body>
    </>
  );
};

export default ProfilePage;
